<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IPL Auction: Me vs You</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0b1220;
      --panel:#121a2b;
      --muted:#93a1b1;
      --text:#e6edf3;
      --accent:#2ea043;
      --accent2:#58a6ff;
      --warn:#f0883e;
      --danger:#ff6b6b;
      --chip:#202a3c;
      --gold:#f5c842;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans","Apple Color Emoji","Segoe UI Emoji";
      background:linear-gradient(180deg,#0b1220,#0a1020);
      color:var(--text);
    }
    header{
      padding:18px 20px;
      border-bottom:1px solid #1c2436;
      position:sticky;top:0;background:#0b1220;z-index:10;
      display:flex;gap:16px;align-items:center;flex-wrap:wrap
    }
    h1{margin:0;font-size:20px}
    .badge{background:var(--chip);color:var(--muted);padding:6px 10px;border-radius:999px;font-size:13px}
    main{padding:18px;max-width:1200px;margin:0 auto}
    .grid{
      display:grid;gap:16px;
      grid-template-columns:repeat(12,1fr);
    }
    .panel{
      background:var(--panel);border:1px solid #1c2436;border-radius:12px;padding:14px;
    }
    .title{font-weight:600;margin:0 0 10px 0;font-size:15px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    input,textarea,select,button{
      background:#0f1626;color:var(--text);border:1px solid #243049;border-radius:10px;
      padding:10px 12px;font-size:14px;outline:none
    }
    textarea{min-height:110px;width:100%;resize:vertical}
    button{cursor:pointer}
    button.primary{background:var(--accent2);border-color:#335d92}
    button.success{background:var(--accent);border-color:#2a7a3e}
    button.warn{background:var(--warn);border-color:#9d612c}
    button.ghost{background:transparent;border-color:#2a3753}
    button.danger{background:var(--danger);border-color:#a84545}
    button:disabled{opacity:.6;cursor:not-allowed}
    .cols-6{grid-column:span 6}
    .cols-4{grid-column:span 4}
    .cols-8{grid-column:span 8}
    .cols-12{grid-column:span 12}
    .stat{
      padding:10px 12px;background:#0f1726;border:1px solid #223050;border-radius:10px;
      display:flex;flex-direction:column;gap:4px;min-width:110px
    }
    .stat .k{font-size:12px;color:var(--muted)}
    .stat .v{font-size:18px;font-weight:700}
    .pool{
      display:flex;flex-wrap:wrap;gap:8px;max-height:152px;overflow:auto;padding:6px;background:rgba(255,255,255,0.02);border-radius:10px;border:1px dashed #294064
    }
    .chip{
      background:var(--chip);border:1px solid #2a3b58;color:var(--text);padding:6px 10px;border-radius:999px;font-size:13px;display:inline-flex;gap:8px;align-items:center
    }
    .chip .x{opacity:.6;cursor:pointer}
    .two-col{
      display:grid;gap:12px;grid-template-columns:1fr 1fr
    }
    .team{
      display:flex;flex-direction:column;gap:8px;max-height:260px;overflow:auto
    }
    .row-between{display:flex;justify-content:space-between;align-items:center}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .log{
      background:#0b1120;border:1px solid #223050;border-radius:10px;padding:10px;min-height:120px;max-height:200px;overflow:auto;font-size:13px;line-height:1.4
    }
    .lead{
      font-size:26px;font-weight:800;letter-spacing:.3px
    }
    .gold{color:var(--gold)}
    .muted{color:var(--muted)}
    .bar{height:8px;background:#0f1726;border:1px solid #26324b;border-radius:999px;overflow:hidden}
    .fill{height:100%;background:linear-gradient(90deg,#2ea043,#58a6ff)}
    @media (max-width:960px){
      .cols-6,.cols-4,.cols-8,.cols-12{grid-column:span 12}
      .two-col{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <header>
    <h1>IPL Auction: Me vs You</h1>
    <span class="badge">Purse: 120 cr each</span>
    <span class="badge">Base: 0.5 cr • Inc: 0.5 cr</span>
    <span class="badge">Target squad: 12–15</span>
  </header>

  <main>
    <div class="grid">
      <section class="panel cols-8" id="setup">
        <p class="title">Step 1 — Add 5 players each to the pool</p>
        <div class="two-col">
          <div>
            <div class="row-between">
              <label>Your nominees (5)</label>
              <small class="muted">One per line</small>
            </div>
            <textarea id="userNominees" placeholder="Enter exactly 5 players&#10;e.g. Shubman Gill&#10;Suryakumar Yadav&#10;Glenn Maxwell&#10;Ravindra Jadeja&#10;Mitchell Starc"></textarea>
          </div>
          <div>
            <div class="row-between">
              <label>My nominees (5)</label>
              <small class="muted">Editable</small>
            </div>
            <textarea id="cpuNominees">Virat Kohli
Jasprit Bumrah
Hardik Pandya
Rashid Khan
Rishabh Pant</textarea>
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="row">
          <label>Base</label>
          <input id="basePrice" type="number" step="0.5" value="0.5" style="width:90px" />
          <label>Increment</label>
          <input id="increment" type="number" step="0.5" value="0.5" style="width:90px" />
          <label>Purse</label>
          <input id="purseInput" type="number" step="0.5" value="120" style="width:100px" />
          <button class="primary" id="addToPoolBtn">Add to pool</button>
          <button class="success" id="startRoundBtn" disabled>Start auction round</button>
        </div>
        <div style="height:10px"></div>
        <div>
          <div class="row" style="justify-content:space-between;align-items:center">
            <div class="row" style="gap:8px">
              <span class="muted">Round pool</span>
              <span class="badge" id="poolCount">0/10</span>
            </div>
            <div class="bar" style="width:260px"><div class="fill" id="poolFill" style="width:0%"></div></div>
          </div>
          <div class="pool" id="poolChips"></div>
        </div>
      </section>

      <section class="panel cols-4">
        <p class="title">Round & purse</p>
        <div class="row" style="gap:10px;flex-wrap:wrap">
          <div class="stat"><span class="k">Round</span><span class="v" id="roundNo">1</span></div>
          <div class="stat"><span class="k">Opening bidder</span><span class="v" id="openingBidder">You</span></div>
          <div class="stat"><span class="k">Remaining in pool</span><span class="v" id="remainingInPool">0</span></div>
        </div>
        <div style="height:10px"></div>
        <div class="two-col">
          <div class="stat">
            <span class="k">Your purse</span>
            <span class="v mono" id="purseUser">120.0</span>
          </div>
          <div class="stat">
            <span class="k">My purse</span>
            <span class="v mono" id="purseCPU">120.0</span>
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="two-col">
          <div class="stat">
            <span class="k">Your squad size</span>
            <span class="v" id="squadUser">0</span>
          </div>
          <div class="stat">
            <span class="k">My squad size</span>
            <span class="v" id="squadCPU">0</span>
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="row">
          <button class="ghost" id="nextRoundBtn" disabled>Start next round</button>
          <button class="warn" id="finishBtn" disabled>Finish when 12–15</button>
        </div>
      </section>

      <section class="panel cols-12" id="auction" style="display:none">
        <div class="row-between">
          <div>
            <div class="muted">Current player</div>
            <div class="lead" id="currentPlayer">—</div>
          </div>
          <div class="row" style="gap:14px">
            <div class="stat">
              <span class="k">Current bid</span>
              <span class="v mono" id="currentBid">—</span>
            </div>
            <div class="stat">
              <span class="k">Highest bidder</span>
              <span class="v" id="highestBidder">—</span>
            </div>
            <div class="stat">
              <span class="k">Turn</span>
              <span class="v" id="turnBadge">—</span>
            </div>
          </div>
        </div>
        <div style="height:10px"></div>
        <div class="row">
          <button id="drawBtn" class="primary">Draw next player</button>
          <button id="bidBtn" class="success" disabled>Bid</button>
          <button id="passBtn" class="danger" disabled>Pass</button>
          <button id="skipBtn" class="ghost" disabled>Skip player (unsold)</button>
        </div>
        <div style="height:10px"></div>
        <div class="log mono" id="log"></div>
      </section>

      <section class="panel cols-6">
        <p class="title">Your team</p>
        <div class="team" id="teamUser"></div>
      </section>
      <section class="panel cols-6">
        <p class="title">My team</p>
        <div class="team" id="teamCPU"></div>
      </section>
    </div>
  </main>

  <script>
    const els = {
      userNominees: document.getElementById('userNominees'),
      cpuNominees: document.getElementById('cpuNominees'),
      basePrice: document.getElementById('basePrice'),
      increment: document.getElementById('increment'),
      purseInput: document.getElementById('purseInput'),
      addToPoolBtn: document.getElementById('addToPoolBtn'),
      startRoundBtn: document.getElementById('startRoundBtn'),
      poolChips: document.getElementById('poolChips'),
      poolCount: document.getElementById('poolCount'),
      poolFill: document.getElementById('poolFill'),
      roundNo: document.getElementById('roundNo'),
      openingBidder: document.getElementById('openingBidder'),
      remainingInPool: document.getElementById('remainingInPool'),
      purseUser: document.getElementById('purseUser'),
      purseCPU: document.getElementById('purseCPU'),
      squadUser: document.getElementById('squadUser'),
      squadCPU: document.getElementById('squadCPU'),
      nextRoundBtn: document.getElementById('nextRoundBtn'),
      finishBtn: document.getElementById('finishBtn'),
      auction: document.getElementById('auction'),
      drawBtn: document.getElementById('drawBtn'),
      bidBtn: document.getElementById('bidBtn'),
      passBtn: document.getElementById('passBtn'),
      skipBtn: document.getElementById('skipBtn'),
      currentPlayer: document.getElementById('currentPlayer'),
      currentBid: document.getElementById('currentBid'),
      highestBidder: document.getElementById('highestBidder'),
      turnBadge: document.getElementById('turnBadge'),
      log: document.getElementById('log'),
      teamUser: document.getElementById('teamUser'),
      teamCPU: document.getElementById('teamCPU'),
      setup: document.getElementById('setup'),
    };

    const state = {
      round: 1,
      base: 0.5,
      inc: 0.5,
      purseStart: 120,
      opening: 'You', // alternates across players
      turn: 'You',
      pool: [], // [{name, id}]
      soldThisRound: 0,
      unsoldThisRound: 0,
      nextId: 1,
      current: null, // {name,id, bid, highest, active, cpuVal}
      purse: { You: 120, Me: 120 },
      team: { You: [], Me: [] }, // [{name, price, id, round}]
      rosterMin: 12,
      rosterMax: 15,
    };

    // Utils
    const fmt = (n) => Number(n).toFixed(1) + ' cr';
    const rand = (a,b) => Math.random()*(b-a)+a;
    const clamp2 = (n) => Math.round(n*2)/2;

    function log(line){
      const ts = new Date().toLocaleTimeString();
      els.log.innerHTML = `[${ts}] ${line}<br>` + els.log.innerHTML;
    }

    function renderPool(){
      els.poolChips.innerHTML = '';
      state.pool.forEach(p=>{
        const c = document.createElement('span');
        c.className = 'chip';
        c.textContent = p.name;
        els.poolChips.appendChild(c);
      });
      els.poolCount.textContent = `${state.pool.length}/10`;
      els.poolFill.style.width = `${(state.pool.length/10)*100}%`;
      els.remainingInPool.textContent = state.pool.length;
    }

    function renderTop(){
      els.roundNo.textContent = state.round;
      els.openingBidder.textContent = state.opening;
      els.purseUser.textContent = fmt(state.purse.You);
      els.purseCPU.textContent = fmt(state.purse.Me);
      els.squadUser.textContent = state.team.You.length;
      els.squadCPU.textContent = state.team.Me.length;
      els.finishBtn.disabled = !canFinish();
    }

    function renderTeams(){
      const renderTeam = (who, root) => {
        root.innerHTML = '';
        state.team[who].forEach(player=>{
          const row = document.createElement('div');
          row.className = 'row-between';
          row.innerHTML = `
            <div class="row" style="gap:8px">
              <span class="chip">${player.name}</span>
              <span class="muted mono">@ ${fmt(player.price)}</span>
              <span class="badge">R${player.round}</span>
            </div>
            <div class="row" style="gap:8px">
              ${who==='You' ? `<button class="ghost" data-drop="${player.id}">Drop</button>`:''}
            </div>
          `;
          root.appendChild(row);
        });
        if (who==='You') {
          root.querySelectorAll('[data-drop]').forEach(btn=>{
            btn.addEventListener('click', ()=>{
              if(state.current?.active){ alert('Finish current auction before dropping.'); return; }
              const id = Number(btn.getAttribute('data-drop'));
              const i = state.team.You.findIndex(x=>x.id===id);
              if(i>=0){
                const [pl] = state.team.You.splice(i,1);
                state.purse.You = clamp2(state.purse.You + pl.price);
                log(`You dropped ${pl.name}, purse refunded ${fmt(pl.price)}.`);
                renderTop(); renderTeams();
              }
            });
          });
        }
      };
      renderTeam('You', els.teamUser);
      renderTeam('Me', els.teamCPU);
    }

    function resetAuctionUI(){
      els.currentPlayer.textContent = '—';
      els.currentBid.textContent = '—';
      els.highestBidder.textContent = '—';
      els.turnBadge.textContent = '—';
      els.bidBtn.disabled = true;
      els.passBtn.disabled = true;
      els.skipBtn.disabled = true;
    }

    function startRound(){
      state.soldThisRound = 0;
      state.unsoldThisRound = 0;
      state.opening = 'You'; // fresh round: You open
      renderTop();
      els.auction.style.display = 'block';
      resetAuctionUI();

      // Enable first draw so bidding can start
      els.drawBtn.disabled = false;
      els.skipBtn.disabled = true;

      log(`Round ${state.round} started. Opening bidder: ${state.opening}.`);
    }

    function drawNext(){
      if(state.current?.active){ return; }
      if(state.pool.length===0){
        log('No players left in round pool.');
        els.drawBtn.disabled = true;
        els.skipBtn.disabled = true;
        maybeEnableNextRound();
        return;
      }

      // Opener acts first on this draw
      state.turn = state.opening;

      const idx = Math.floor(Math.random()*state.pool.length);
      const pl = state.pool.splice(idx,1)[0];

      const base = state.base;
      state.current = {
        id: pl.id,
        name: pl.name,
        bid: 0,
        highest: null,
        active: true,
        minBid: base,
        opener: state.opening,
        round: state.round,
        // CPU simple valuation with small bias for seed list
        cpuVal: clamp2(rand(2, 20) + (['Virat Kohli','Jasprit Bumrah','Hardik Pandya','Rashid Khan','Rishabh Pant'].includes(pl.name)? 5:0))
      };

      els.currentPlayer.textContent = pl.name;
      els.currentBid.textContent = fmt(0);
      els.highestBidder.textContent = '—';
      els.turnBadge.textContent = state.turn;

      // Opener gets controls; the other side waits
      els.bidBtn.disabled = (state.turn!=='You');
      els.passBtn.disabled = (state.turn!=='You');

      els.skipBtn.disabled = false;
      els.drawBtn.disabled = true;

      renderPool(); renderTop();
      log(`Drew ${pl.name}. Opening bidder: ${state.opening}.`);
      if(state.turn === 'Me') cpuAct();
    }

    function bid(who){
      if(!state.current?.active) return;
      const inc = state.current.bid===0 ? state.current.minBid : state.inc;
      let next = clamp2(state.current.bid + inc);

      if(state.purse[who] < next) {
        log(`${who} cannot bid ${fmt(next)} (insufficient purse).`);
        if(who==='You'){ return; } else { return cpuPass(); }
      }
      if((who==='You' && state.team.You.length>=state.rosterMax) || (who==='Me' && state.team.Me.length>=state.rosterMax)){
        log(`${who} has reached the roster limit ${state.rosterMax}.`);
        if(who==='You'){ return; } else { return cpuPass(); }
      }

      state.current.bid = next;
      state.current.highest = who;
      state.turn = (who==='You') ? 'Me' : 'You';

      els.currentBid.textContent = fmt(state.current.bid);
      els.highestBidder.textContent = who;
      els.turnBadge.textContent = state.turn;

      log(`${who} bids ${fmt(next)} for ${state.current.name}.`);

      if(state.turn==='Me') { els.bidBtn.disabled = true; els.passBtn.disabled = true; cpuAct(); }
      else { els.bidBtn.disabled = false; els.passBtn.disabled = false; }
    }

    function pass(who){
      if(!state.current?.active) return;
      log(`${who} passes on ${state.current.name}.`);
      if(state.current.highest===null){
        // Switch to other side; if both pass, mark unsold with Skip
        state.turn = (who==='You') ? 'Me' : 'You';
        els.turnBadge.textContent = state.turn;
        if(state.turn==='Me') cpuAct();
        else { els.bidBtn.disabled = false; els.passBtn.disabled = false; }
        return;
      }
      // Award to highest
      sellCurrent();
    }

    function skipUnsold(){
      if(!state.current?.active) return;
      log(`${state.current.name} goes UNSOLD.`);
      state.current.active = false;
      state.unsoldThisRound++;

      resetAuctionUI();
      renderTop();

      // Allow next draw
      els.drawBtn.disabled = false;
      els.skipBtn.disabled = true;

      // Alternate opening bidder for next draw
      state.opening = (state.opening === 'You') ? 'Me' : 'You';

      maybeEnableNextRound();
    }

    function sellCurrent(){
      const buyer = state.current.highest;
      const price = state.current.bid;
      if(!buyer){ return skipUnsold(); }

      state.purse[buyer] = clamp2(state.purse[buyer] - price);
      state.team[buyer].push({ id: state.current.id, name: state.current.name, price, round: state.current.round });
      state.current.active = false;
      state.soldThisRound++;

      log(`${state.current.name} SOLD to ${buyer} for ${fmt(price)}.`);
      renderTop(); renderTeams();

      resetAuctionUI();

      // Allow next draw
      els.drawBtn.disabled = false;
      els.skipBtn.disabled = true;

      // Alternate opening bidder for next draw
      state.opening = (state.opening === 'You') ? 'Me' : 'You';

      maybeEnableNextRound();
    }

    function canFinish(){
      const yu = state.team.You.length, me = state.team.Me.length;
      const okA = yu>=state.rosterMin && yu<=state.rosterMax;
      const okB = me>=state.rosterMin && me<=state.rosterMax;
      return okA && okB;
    }

    function maybeEnableNextRound(){
      const done10 = (state.soldThisRound + state.unsoldThisRound) >= 10;
      if(done10){
        els.nextRoundBtn.disabled = false;
        log(`Round ${state.round} completed. Sold: ${state.soldThisRound}, Unsold: ${state.unsoldThisRound}.`);
      }
    }

    // CPU logic
    function cpuAct(){
      if(!state.current?.active) return;
      if(state.turn!=='Me') return;
      // Simple strategy: bid if next price <= valuation and purse allows
      setTimeout(()=>{
        const inc = state.current.bid===0 ? state.current.minBid : state.inc;
        const next = clamp2(state.current.bid + inc);
        const val = Math.min(state.current.cpuVal, state.purse.Me); // cannot exceed purse
        const canRoster = state.team.Me.length < state.rosterMax;

        if(canRoster && next <= val && next <= state.purse.Me){
          bid('Me');
        } else {
          cpuPass();
        }
      }, 700);
    }

    function cpuPass(){
      pass('Me');
    }

    // Events
    els.addToPoolBtn.addEventListener('click', ()=>{
      if(state.pool.length>0){ alert('Round pool already created. Start the round or go Next Round.'); return; }
      const u = els.userNominees.value.split('\n').map(s=>s.trim()).filter(Boolean);
      const c = els.cpuNominees.value.split('\n').map(s=>s.trim()).filter(Boolean);
      if(u.length!==5 || c.length!==5){ alert('Please enter exactly 5 players on each side.'); return; }

      // settings
      const base = parseFloat(els.basePrice.value||'0.5');
      const inc = parseFloat(els.increment.value||'0.5');
      const purse = parseFloat(els.purseInput.value||'120');

      if(!(base>0) || !(inc>0) || !(purse>0)){ alert('Invalid base, increment, or purse.'); return; }

      state.base = clamp2(base);
      state.inc = clamp2(inc);

      // On first round allow purse override
      if(state.round===1){
        state.purseStart = clamp2(purse);
        state.purse.You = state.purseStart;
        state.purse.Me = state.purseStart;
      }

      // Merge into pool (dedupe by lowercase)
      const seen = new Set();
      const both = [...u, ...c].filter(n=>{
        const k = n.toLowerCase();
        if(seen.has(k)) return false;
        seen.add(k); return true;
      }).slice(0,10);

      if(both.length!==10){ alert('Ensure unique names; need 10 total.'); return; }

      state.pool = both.map(name=>({ id: state.nextId++, name }));
      renderPool(); renderTop();
      els.startRoundBtn.disabled = false;
      log(`Added 10 players to round pool.`);
    });

    els.startRoundBtn.addEventListener('click', ()=>{
      if(state.pool.length!==10){ alert('Add exactly 10 players before starting.'); return; }
      els.startRoundBtn.disabled = true;
      startRound();
    });

    els.drawBtn.addEventListener('click', drawNext);
    els.bidBtn.addEventListener('click', ()=> bid('You'));
    els.passBtn.addEventListener('click', ()=> pass('You'));
    els.skipBtn.addEventListener('click', skipUnsold);

    // Keep Bid/Pass synced to current turn using a MutationObserver on the turn label
    const observer = new MutationObserver(()=>{
      const t = els.turnBadge.textContent.trim();
      const active = !!(state.current && state.current.active);
      els.bidBtn.disabled = (t!=='You') || !active;
      els.passBtn.disabled = (t!=='You') || !active;
    });
    observer.observe(els.turnBadge, { childList:true });

    els.nextRoundBtn.addEventListener('click', ()=>{
      if(state.current?.active){ alert('Finish current auction before starting next round.'); return; }
      // Reset round UI
      state.round += 1;
      state.pool = [];
      state.soldThisRound = 0;
      state.unsoldThisRound = 0;
      state.opening = 'You'; // Step 1 resets opener to You for new round
      renderPool(); renderTop(); resetAuctionUI();
      els.userNominees.value = '';
      els.startRoundBtn.disabled = true;
      els.nextRoundBtn.disabled = true;
      els.drawBtn.disabled = true;
      els.skipBtn.disabled = true;
      els.auction.style.display = 'block';
      log(`Prepare Step 1 again: add five each for Round ${state.round}.`);
    });

    els.finishBtn.addEventListener('click', ()=>{
      if(!canFinish()){ alert('Finish when both squads are between 12 and 15.'); return; }
      const yu = state.team.You.length, me = state.team.Me.length;
      log(`Auction complete. Final squads — You: ${yu} players, Me: ${me} players.`);
      alert('Auction complete! Check the log and team panels for results.');
    });

    // Keyboard shortcuts: B = bid, P = pass, D = draw
    window.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase()==='b' && !els.bidBtn.disabled) bid('You');
      if(e.key.toLowerCase()==='p' && !els.passBtn.disabled) pass('You');
      if(e.key.toLowerCase()==='d' && !els.drawBtn.disabled) drawNext();
    });

    // Initialize
    renderPool(); renderTop(); renderTeams(); resetAuctionUI();
    els.drawBtn.disabled = true;
    els.skipBtn.disabled = true;
  </script>
</body>
</html>
